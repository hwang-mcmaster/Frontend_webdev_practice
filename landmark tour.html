<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Landmark Walking Tour</title>

  <style>
    body { margin: 0; font-family: Arial, sans-serif; padding: 10px; box-sizing: border-box; }
    #app { display: flex; gap: 10px; }  /* Responsive Design: desktop layout: map + panel side by side */
    #map { flex: 2; min-height: 60vh; border: 1px solid #807f7f; border-radius: 8px; } /* Interactive Google Map map: always visible and main focus */
    #panel { flex: 1; border: 1px solid #807f7f; border-radius: 8px; padding: 10px; box-sizing: border-box; }
    input, textarea, button { width: 100%; box-sizing: border-box; font-size: 16px; }
    input, textarea { padding: 10px; margin: 6px 0; }
    textarea { min-height: 70px; resize: vertical; }
    button { padding: 12px; margin: 6px 0; }
    .row { display: flex; gap: 8px; }

    #preview img, .thumb {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 6px 0;
      border-radius: 6px;
    }

    .item {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 8px;
      margin: 8px 0;
    }

    .item button {
      width: auto;
      margin: 4px 4px 0 0;
    }

    #msg { margin: 6px 0; }

    @media (max-width: 900px) {
      #app { flex-direction: column; }
      #map { min-height: 50vh; }
    }
  </style>
</head>

<body>
  <h1>City Walking Tour Map</h1>
  <p>
    This application is designed for users creating walking tours of local landmarks by associating photos and descriptions with real-world locations on a map.
  </p>

  <!--setting a map dic so that the map is always displayed-->
  <div id="app">
    <div id="map"></div> 

    <div id="panel">
      <div id="msg"></div>

      <input id="title" placeholder="Landmark title">
      <textarea id="desc" placeholder="Landmark description (1 to 3 sentences)"></textarea>
      <input id="img" type="file" accept="image/*" multiple>

      <div class="row">
        <button id="geo" type="button">Use my location</button>
      </div>

      <div class="row">
        <input id="lat" placeholder="Latitude">
        <input id="lng" placeholder="Longitude">
      </div>

      <div class="row">
        <button id="save" type="button">Add landmark</button>
        <button id="cancel" type="button" style="display:none;">Cancel edit</button>
      </div>

      <div id="preview"></div>

      <hr>
      <div id="list"></div>
    </div>
  </div>

  <script>
    // Storing Data in JS memory
    const landmarks = []
    const markers = {}
    let images = []
    let map, info, editingId = null

    const titleEl = document.getElementById("title")
    const descEl = document.getElementById("desc")
    const imgEl = document.getElementById("img")
    const latEl = document.getElementById("lat")
    const lngEl = document.getElementById("lng")
    const previewEl = document.getElementById("preview")
    const listEl = document.getElementById("list")
    const msgEl = document.getElementById("msg")
    const cancelBtn = document.getElementById("cancel")
    const saveBtn = document.getElementById("save")

    function msg(t) { msgEl.textContent = t }

    /* B. Landmark Data Entry Validation */
    function countSentences(text) {
      const parts = text.split(/[.!?]+/)
      let c = 0
      for (let i = 0; i < parts.length; i++) if (parts[i].trim() !== "") c++
      return c
    }

    /* A. Photo Upload & Client Side Storage (store files in memory and preview them) */
    function handleImageChange() {
      images = []
      previewEl.innerHTML = ""
      for (const f of imgEl.files) {
        images.push(f)
        const im = document.createElement("img")
        im.src = URL.createObjectURL(f)
        previewEl.appendChild(im)
      }
    }

    imgEl.addEventListener("change", handleImageChange)

    /* C. Location Assignment */
    document.getElementById("geo").onclick = function () {
      if (!navigator.geolocation) { msg("No geolocation support"); return }
      navigator.geolocation.getCurrentPosition(function (p) {
        latEl.value = p.coords.latitude
        lngEl.value = p.coords.longitude
        msg("Location filled")
      }, function () {
        msg("Geolocation blocked")
      })
    }

    /* D. Interactive Google Map: marker click shows title desc images */
    function infoHtml(lm) {
      let h = "<h3>" + lm.title + "</h3><p>" + lm.desc + "</p>"
      for (const f of lm.files) {
        h += "<img class='thumb' src='" + URL.createObjectURL(f) + "'>"
      }
      return h
    }

    function upsertMarker(lm) {
      let m = markers[lm.id]
      if (!m) {
        m = new google.maps.Marker({ map, position: { lat: lm.lat, lng: lm.lng }, title: lm.title })
        m.addListener("click", function () {
          info.setContent(infoHtml(lm))
          info.open(map, m)
        })
        markers[lm.id] = m
      }
      m.setPosition({ lat: lm.lat, lng: lm.lng })
      m.setMap(lm.visible ? map : null)
    }

    /* F. Show hide delete edit: list UI to control each landmark */
    function renderList() {
      listEl.innerHTML = ""
      for (const lm of landmarks) {
        const d = document.createElement("div")
        d.className = "item"
        d.innerHTML = "<b>" + lm.title + "</b><div>Lat: " + lm.lat + " Lng: " + lm.lng + "</div>"

        /* Show hide individual landmarks */
        const hideBtn = document.createElement("button")
        hideBtn.textContent = lm.visible ? "Hide" : "Show"
        hideBtn.onclick = function () {
          lm.visible = !lm.visible
          upsertMarker(lm)
          renderList()
        }

        /* Landmark after craetion */
        const editBtn = document.createElement("button")
        editBtn.textContent = "Edit"
        editBtn.onclick = function () { startEdit(lm.id) }

        /* Delete landmark and its marker */
        const delBtn = document.createElement("button")
        delBtn.textContent = "Delete"
        delBtn.onclick = function () { del(lm.id) }

        d.appendChild(hideBtn)
        d.appendChild(editBtn)
        d.appendChild(delBtn)
        listEl.appendChild(d)
      }
    }

    function startEdit(id) {
      const lm = landmarks.find(x => x.id === id)
      if (!lm) return
      editingId = id
      titleEl.value = lm.title
      descEl.value = lm.desc
      latEl.value = lm.lat
      lngEl.value = lm.lng
      previewEl.innerHTML = ""
      for (const f of lm.files) {
        const im = document.createElement("img")
        im.src = URL.createObjectURL(f)
        previewEl.appendChild(im)
      }
      cancelBtn.style.display = "block"
      saveBtn.textContent = "Save"
      msg("Editing landmark")
    }
    /* Cancel Edit */
    cancelBtn.onclick = function () {
      editingId = null
      cancelBtn.style.display = "none"
      saveBtn.textContent = "Add landmark"
      previewEl.innerHTML = ""
      imgEl.value = ""
      images = []
      msg("")
    }

    function del(id) {
      const i = landmarks.findIndex(x => x.id === id)
      if (i === -1) return
      if (markers[id]) { markers[id].setMap(null); delete markers[id] }
      landmarks.splice(i, 1)
      renderList()
      msg("Landmark deleted")
    }
    /* Create landmark,  Store location,  Store images,  Add marker, Edit + validation */
    saveBtn.onclick = function () {
      const title = titleEl.value.trim()
      const desc = descEl.value.trim()
      const lat = Number(latEl.value)
      const lng = Number(lngEl.value)

      if (!title || !desc) { msg("Missing Title and description"); return }
      if (countSentences(desc) < 1 || countSentences(desc) > 3) { msg("Description must be 1 to 3 sentences"); return }
      if (!Number.isFinite(lat) || !Number.isFinite(lng)) { msg("Invalid coordinates"); return }

      let files = images.slice()  /* setting another array, or Clearing images later would also erase files */
      if (editingId) {
        const lm = landmarks.find(x => x.id === editingId)
        if (files.length === 0) files = lm.files 
        lm.title = title
        lm.desc = desc
        lm.lat = lat
        lm.lng = lng
        lm.files = files
        upsertMarker(lm)
        editingId = null
      } else {
        if (files.length === 0) { msg("At least one image is required"); return }
        const lm = { id: String(Date.now()), title, desc, lat, lng, files, visible: true }
        landmarks.push(lm)
        upsertMarker(lm)
      }

      renderList()

      titleEl.value = "" /* resets info after creation */
      descEl.value = ""
      latEl.value = ""
      lngEl.value = ""

      previewEl.innerHTML = ""
      imgEl.value = ""
      images = []
      saveBtn.textContent = "Add landmark"
      cancelBtn.style.display = "none"
      msg("Saved")
    }

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 43.651070, lng: -79.347015 },  // Downtown Toronto Coordinates :)
        zoom: 10
      })
      info = new google.maps.InfoWindow()

      /* F. Use browser geolocation to set the initial map view */
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (p) {
          map.setCenter({ lat: p.coords.latitude, lng: p.coords.longitude })
          map.setZoom(12)
        })
      }
    }

    window.initMap = initMap
  </script>
  
  <script src="https://maps.googleapis.com/maps/api/js?key=&callback=initMap" async defer></script>
</body>
</html>
